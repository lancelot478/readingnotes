记一下之前做技能编辑器的思路、不会涉及到怎么具体实现一个技能编辑器。

## 技能Timeline

## 如何配置技能？

对于配置者来说，需要明确知道技能释放过程中每一时刻（甚至需要精确到帧）会发生什么事。比如什么时候播放施法音效、施法特效、播什么动作播多久、在什么时刻进行伤害结算。所以很直观的想到需要使用到时间轴(timeline)，在时间轴上进行配置。

## 选择什么样的时间轴框架？

Unity自带的Timeline、Slate、Flux（当时在这三个中选择）

1.Unity自带的Timeline ：没有源码、黑盒开发、太重度

2.Flux和Slate都差不多，可以自己改造。因为Slate的clip上可以定制一些内容再加上界面看起来舒服、最终选择了Slate（感兴趣的可以自己研究一下Slate和Flux）

![](https://pic2.zhimg.com/80/v2-9d50f5ebfd58b4db21d2d90f469c3a41_1440w.jpg)

slate原生界面

定制后（去掉一些不需要的功能、增加一些需要的功能）

![](https://pic4.zhimg.com/80/v2-2ae0003c6c641ac9766d3ef817bce0f3_1440w.jpg)

定制后

自己定制（基于项目还有自己的理解搞的、不一定有什么参考价值、就不细说了）。

直接抽成一个比较轻量的编辑器时间轴框架（剧情对白镜头编辑器也可以接这个框架进行实现），方便定制Track、Clip。

编辑器这边只要传进来一个Sequence就可以绘制出时间轴来了。下面是整个时间轴数据Sequence的代码结构

![](https://pic3.zhimg.com/80/v2-772b8d3e0aecc81159a611358f84657a_1440w.jpg)

基类

![](https://pic4.zhimg.com/80/v2-fe626ffc2db48d3f516a39489f3a25eb_1440w.jpg)

![](https://pic2.zhimg.com/80/v2-f2b4b93b5558e7488fc485d77355cf39_1440w.jpg)

Sequence

![](https://pic3.zhimg.com/80/v2-365197888766279af794b3a8254632ce_1440w.jpg)

Group

![](https://pic4.zhimg.com/80/v2-94885533e11a2be87782d14f8f11102f_1440w.jpg)

Track基类

![](https://pic2.zhimg.com/80/v2-96d8eecc8cc532e5091d760f3022de4d_1440w.jpg)

动作轨

![](https://pic4.zhimg.com/80/v2-f34390f7f0925e3de43b378bcddbd47b_1440w.jpg)

clip基类

![](https://pic1.zhimg.com/80/v2-5e8713463fc1849049c2a3bb3fd25668_1440w.jpg)

技能动作Clip

一个Sequence即为一个技能。通过Json来序列化反序列化（项目内是Lua、编辑器的Json数据到Lua还有数据转换过程）

![](https://pic1.zhimg.com/80/v2-0dca877f59986f6559bbf638526ff7c0_1440w.jpg)

一条技能数据在时间轴上展示

![](https://pic4.zhimg.com/80/v2-ce19c0e4398edfc331232556cba2fb0b_1440w.jpg)

序列化的json

时间轴数据即为技能的核心数据、储存了技能动作每一时刻会发生什么事情或行为（播特效、结算、播音效等）。这些事件或者行为就是一个Clip。

### 以上就是技能的Timeline实现的思路。基于Slate自己改造编辑器、然后设计Sequence数据结构做好序列化以及转换成游戏内可读取数据。

## 技能配置预览

理想：配置者在编辑器离线状态下就可以看到一个技能的完整效果并且保证跟游戏内表现一致（不然离线预览没有意义）、基于效果调整配置以达到设计目标。

现实（项目原因）：特效模块的设计以及特效制作标准并不能友好的支持特效在离线状态下的预览。音频也没有很好的支持离线下播放预览。

最终跟策划协商：离线下至少动作、模型能预览。可以基于动作配事件。在线可以看到完整的技能效果。

这里的设计思路：

技能编辑器在配置保存数据时、如果当前是运行时。直接修改运行时的技能数据（相当于热更），提供重载技能数据的GM指令。

好处：游戏内看到的效果就是最终的效果、不会出现在编辑器看正常但是进游戏就错了的情况

坏处：需要启动游戏、开发期可能会被其他模块导致游戏启动失败（小概率）。另外我们是单独做了个技能配置副本。

配置流程：配置修改数据-保存-游戏内释放技能查看效果

离线下的简单预览

![](https://pic2.zhimg.com/80/v2-c130659b595b3c799c66c45a9ccbcb3d_1440w.jpg)

## 数据驱动绘制

技能系统在任何有战斗的游戏来说都是一个大系统，对应的数据也是较为庞大的，就我们项目而言、有八张数据表：技能基础信息表、技能事件（时间轴数据）表、子弹数据表、技能效果表、技能描述表等等。其中字段更是数不胜数。

![](https://pic1.zhimg.com/80/v2-2b15621a8df50fc78fc40118a0071230_1440w.png)

![](https://pic2.zhimg.com/80/v2-ce5ba614b34aea12dcb6d67922b42231_1440w.png)

![](https://pic3.zhimg.com/80/v2-ee0742962faec8a58e2b51f2938fbe7a_1440w.jpg)

简单截了下配置技能会有多少的字段。。。orz

而且在开发期经常会有增删字段、增删事件等情况发生。如果没有数据驱动绘制、可以想象，工具开发人员需要经常性的修改编辑器代码来支持配置。

流程会是：策划发起某个需求->需求导致新增了一个字段->通知开发人员新增配置及导出→策划再去配置

### 总结一下就是策划加字段到配置流程较长、字段数量庞大、开发期改动频率较高。写绘制这样的纯体力活会变的恶心庞大。

### 所以需要实现一套数据驱动绘制的方案

![](https://pic4.zhimg.com/80/v2-c687e921a394279fddc98645dc5792f7_1440w.jpg)

去解析这样的表。编辑器自动根据表内容绘制出上面的配置编辑界面。

该表包含字段名，编辑器上显示的中文名、鼠标悬停提示、字段类型（枚举:在编辑器种会是下拉框的形式、int、float、string、bool等等）、分组、默认值、显示限定（某些字段配置是取决于另外一个字段配置了某个值）等等

*（ps:这个表已经具备一定的语言特性orz）

![](https://pic3.zhimg.com/80/v2-9d337c5f50e928cf73179def37cf3e4a_1440w.jpg)

枚举类型

![](https://pic1.zhimg.com/80/v2-5fb5774b85051e01fd2ca130de07cffc_1440w.jpg)

字段配置提示

![](https://pic3.zhimg.com/80/v2-cb0dd81704785cf5d5c0c98bd26fafd6_1440w.jpg)

分组及bool类型

解析绘制代码（比较挫、还没来得及整理）

![](https://pic3.zhimg.com/80/v2-c6edfea208074e463b984bd38710521a_1440w.jpg)

同时，json数据也会基于这个表序列化反序列化。

如此一来、流程就变的更快了。因需求需要新增字段，直接在表中增加改字段、编辑器刷新进行配置导出。

## 多人协作的问题

## 关于ID分配

绝大部分做法是，分ID段，不同的人占不同的ID段。存在的问题：成员员流动、ID段不够或者浪费、用错ID等。

往前走一步，布一个ID申请器或者申请服务。所人有在创建技能时、自动申请一个ID、制定ID生成策略（我们是从1逐加）。定期回收没使用的ID。

好处：ID不会冲突、不会浪费、 坏处：ID只是作为一个序列ID号、没有语义（不过可以通过制定更丰富的ID生成策略来弥补）

## 关于数据文件冲突

使用SVN的情况下，只要是多人写一份文件，是不可避免会发生冲突的（我们项目组配置技能的人有10来个）。冲突起来情况惨烈。万一存在不会解决冲突的同学orz、提交冲突文件上去。就坏事儿了。

一开始是八张表导出八个lua数据文件。冲突严重。不会解决冲突的大有人在。

重新规划了一下数据组织，思路是：数据粒度尽可能小

数据以技能为单位、为一个文件夹、序列化的文件每个字段为一行。

好处：除非改同一个技能的同一个字段、不然不会出现冲突。当然如果出现了，这是团队成员沟通问题。

坏处：技能数据散文件过多、需要配套开发一个合并数据的流程。运行时肯定不会读这些散文件。

总得实施下来看、利大于弊。

## 其他边缘小模块设计

集成一些SVN操作，快捷入口等

![](https://pic1.zhimg.com/80/v2-e421dc3a11dc2e36f519bb95269a67c8_1440w.png)

![](https://pic2.zhimg.com/80/v2-4ac429bb708f0e0f57dbc27de0be3eb9_1440w.jpg)

技能目录收纳管理技能

资源管理：动作、模型、事件

![](https://pic3.zhimg.com/80/v2-a7efcea1e972d97a33264e951440d396_1440w.jpg)

![](https://pic3.zhimg.com/80/v2-9c0ac46904bc6a27ad05112efdaca1ca_1440w.jpg)

技能编辑器的全貌了
